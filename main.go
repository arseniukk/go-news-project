package main

import (
	"fmt"
	"log"
	"net/http"
	"time"
)

// homeHandler - —Ü–µ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –æ–±—Ä–æ–±–ª—è—î –∑–∞–ø–∏—Ç–∏ –¥–æ –Ω–∞—à–æ–≥–æ —Å–∞–π—Ç—É
func homeHandler(w http.ResponseWriter, r *http.Request) {
	// 1. –£—Å–∫–ª–∞–¥–Ω–µ–Ω–Ω—è: –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É –≤ –∫–æ–Ω—Å–æ–ª—å
	log.Printf("–û—Ç—Ä–∏–º–∞–Ω–æ –∑–∞–ø–∏—Ç: %s %s", r.Method, r.URL.Path)

	// 2. –£—Å–∫–ª–∞–¥–Ω–µ–Ω–Ω—è: –û–±—Ä–æ–±–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ URL (?category=...)
	category := r.URL.Query().Get("category")

	// –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∫–æ–¥—É–≤–∞–Ω–Ω—è, —â–æ–± —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞–ª–∏—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ
	w.Header().Set("Content-Type", "text/html; charset=utf-8")

	// 3. –í–∏—Ö—ñ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è HTML —á–µ—Ä–µ–∑ fmt.Fprintf
	fmt.Fprintf(w, "<h1>üì∞ –í—ñ—Ç–∞—î–º–æ –Ω–∞ –ø–æ—Ä—Ç–∞–ª—ñ '–ù–æ–≤–∏–Ω–∏ –ì–æ–ª–æ–≤–Ω–æ–≥–æ'</h1>")
	fmt.Fprintf(w, "<p>–°—å–æ–≥–æ–¥–Ω—ñ: %s</p>", time.Now().Format("02.01.2006 15:04:05"))

	if category != "" {
		fmt.Fprintf(w, "<h2>–†–æ–∑–¥—ñ–ª: <span style='color: #e74c3c;'>%s</span></h2>", category)
		fmt.Fprintf(w, "<p>–¢—É—Ç —Å–∫–æ—Ä–æ –∑'—è–≤–ª—è—Ç—å—Å—è —Å–≤—ñ–∂—ñ –Ω–æ–≤–∏–Ω–∏ –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó %s...</p>", category)
	} else {
		fmt.Fprintf(w, "<h3>–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –Ω–æ–≤–∏–Ω:</h3>")
		fmt.Fprintf(w, "<ul><li><a href='/?category=–ü–æ–ª—ñ—Ç–∏–∫–∞'>–ü–æ–ª—ñ—Ç–∏–∫–∞</a></li><li><a href='/?category=–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó'>–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó</a></li></ul>")
	}
}

func main() {
	// –ü—Ä–∏–∑–Ω–∞—á–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –≥–æ–ª–æ–≤–Ω–æ–≥–æ —à–ª—è—Ö—É "/"
	http.HandleFunc("/", homeHandler)

	fmt.Println("–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω–æ! –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ http://localhost:8080")
	
	// –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8080
	err := http.ListenAndServe(":8080", nil)
	if err != nil {
		log.Fatal("–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø—É—Å–∫—É: ", err)
	}
}